{% extends "base.html" %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'checkout/css/checkout.css' %}">
{% endblock %}

{% block content %}
<section class="container-fluid checkout-container" role="region" aria-labelledby="checkout-heading">

  <!-- Progress Tracker -->
  <div class="checkout-progress mb-5 text-center" aria-labelledby="progress-heading">
    <h2 id="checkout-heading" class="mb-4">Secure Checkout</h2>
    <div class="progress-steps d-flex justify-content-between align-items-center mt-4" aria-label="Checkout progress steps">
      <div id="progress-step-1" class="step step-active" aria-label="Step 1: Contact Details">1</div>
      <div id="progress-step-2" class="step" aria-label="Step 2: Billing Information">2</div>
      <div id="progress-step-3" class="step" aria-label="Step 3: Order Summary">3</div>
      <div id="progress-step-4" class="step" aria-label="Step 4: Payment">4</div>
      <div id="progress-step-5" class="step" aria-label="Step 5: Confirmation">5</div>
    </div>
    <div class="progress-labels d-flex justify-content-between mt-2 small text-muted" aria-hidden="true">
      <div>Contact<br>Details</div>
      <div>Billing<br>Information</div>
      <div>Order<br>Summary</div>
      <div>Payment</div>
      <div>Confirmation</div>
    </div>
  </div>
  
  <h2 class="mb-5 text-center">Review Your Order</h2>

  <!-- Contact Details -->
  <div class="my-4">
    <h4>Contact Details</h4>
    <div class="d-flex justify-content-between align-items-center">
      <p>{{ contact_info.first_name }} {{ contact_info.last_name }}<br>{{ contact_info.email }}</p>
      <a href="/checkout/" class="btn btn-link">Change</a>
    </div>
  </div>
  <hr>
  <!-- Billing Info -->
  <div class="my-4">
    <h4>Billing Information</h4>
    <div class="d-flex justify-content-between align-items-center">
      <p>
      {{ billing_info.billing_street1 }}<br>
      {% if billing_info.billing_street2 %}{{ billing_info.billing_street2 }}<br>{% endif %}
      {{ billing_info.billing_city }}, {{ billing_info.billing_county }}<br>
      {{ billing_info.billing_postcode }} {{ billing_info.billing_country }}
      </p>
      <a href="/checkout/" class="btn btn-link">Change</a>
    </div>
  </div>
  <hr>
  <!-- Order Items -->
  <div class="my-4">
    <h4>Your Order</h4>
    <ul class="list-group">
      {% for item in bag_items %}
        <li class="list-group-item">
          <div class="d-flex flex-column flex-sm-custom-row align-items-start">
            <img 
              src="{{ item.product.image_preview.url }}" 
              alt="{{ item.product.title }}" 
              class="img-fluid me-sm-custom-3 mb-3 mb-sm-0" 
              style="max-width: 120px; height: auto;"
              tyle="max-width: 120px; height: auto;"
            >

            <!-- Product Info -->
            <div class="my-4">
              <strong>{{ item.product.title }}</strong><br>
              {{ item.format|title }}{% if item.license %} ({{ item.license }}){% endif %}{% if item.print_type %} - {{ item.print_type }}{% endif %}
              <br>
              Quantity: {{ item.quantity }}
            </div>
          </div>
        </li>
      {% endfor %}
    </ul>
  </div>
  <hr>
  <!-- Special Offer -->
  {% if special_offer %}
    <div class="alert alert-success my-4">
      <strong>Discount Applied:</strong> {{ special_offer.text }}
    </div>
  {% endif %}

  <!-- Order Total -->
  <div class="my-4">
    <h4>Order Summary</h4>
    <ul class="list-group mt-2">
      <li class="list-group-item d-flex justify-content-between">
        <span>Subtotal</span>
        <strong>€{{ bag_total|floatformat:2 }}</strong>
      </li>
      <li class="list-group-item d-flex justify-content-between">
        <span>VAT ({{ vat_rate_display }}%)</span>
        <strong>€{{ vat|floatformat:2 }}</strong>
      </li>
      <li class="list-group-item d-flex justify-content-between">
        <span>Shipping</span>
        <strong>€{{ shipping_total|floatformat:2 }}</strong>
      </li>
      <li class="list-group-item d-flex justify-content-between">
        <span>Total</span>
        <strong>€{{ grand_total|floatformat:2 }}</strong>
      </li>
    </ul>
  </div>

  <!-- Pagination -->
  <div class="d-flex justify-content-between align-items-center my-5" role="navigation" aria-label="Checkout navigation">
    <a href="{% url 'view_bag' %}" class="btn btn-secondary mt-3 px-3 py-2" aria-label="Go back to shopping bag">
      ⬅ Go back
    </a>
    <a href="/checkout/payment/" class="btn btn-primary btn-custom">
      Proceed to Secure Payment</a>
  </div>
</section>
{% endblock %}
